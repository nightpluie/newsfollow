# 📰 新聞監控儀表板使用說明

## 🎯 系統功能

這是一個**新聞監控與改寫系統**,可以:

1. **自動爬取** UDN、TVBS、ETtoday 三家媒體的即時新聞
2. **智慧比對** 找出 ETtoday 沒有報導的新聞
3. **AI 改寫** 使用 Claude API 以唐鎮宇風格改寫成 ETtoday 稿件

## 🚀 快速開始

### 方式 1: 使用啟動腳本 (推薦)

```bash
cd /Users/nightpluie/Desktop/newsfollow
./start_dashboard.sh
```

### 方式 2: 手動啟動

```bash
cd /Users/nightpluie/Desktop/newsfollow
source .venv/bin/activate
python3 news_dashboard.py
```

啟動後訪問: **http://localhost:5000**

## 📖 操作步驟

### Step 1: 開始爬取

1. 開啟瀏覽器訪問 http://localhost:5000
2. 點擊「🚀 開始爬取並分析」按鈕
3. 等待 10-30 秒 (視網路速度而定)

### Step 2: 查看結果

爬取完成後,你會看到三個面板:

- **📰 UDN 聯合新聞網** - 顯示從 UDN 抓到的新聞
- **📺 TVBS 新聞網** - 顯示從 TVBS 抓到的新聞
- **🌟 ETtoday 新聞雲** - 顯示從 ETtoday 抓到的新聞

以及最重要的:

- **🎯 ETtoday 缺少的新聞** - 列出 UDN/TVBS 有,但 ETtoday 沒有的新聞

### Step 3: AI 改寫

在「ETtoday 缺少的新聞」區塊:

1. 選擇想要改寫的新聞
2. 點擊「✍️ 用 Claude 改寫」按鈕
3. 等待 5-10 秒 (Claude API 處理中)
4. 查看改寫結果:
   - **改寫標題** - 簡潔有力的新聞標題
   - **導言** - 250 字內,涵蓋 5W1H
   - **完整內文** - 400-600 字,採用倒金字塔結構

### Step 4: 複製使用

改寫完成後:
- 可以直接複製標題、導言、內文
- 貼到 ETtoday 後台發布系統
- 或進一步編輯調整

## 🎨 介面說明

### 首頁

```
┌─────────────────────────────────────────────┐
│ 📰 新聞監控儀表板                             │
│ 比對 UDN、TVBS 與 ETtoday,找出獨家新聞並改寫  │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│        🚀 開始爬取並分析                      │
└─────────────────────────────────────────────┘
```

### 爬取結果

```
┌──────────────────┬──────────────────┬──────────────────┐
│ 📰 UDN (32)      │ 📺 TVBS (52)     │ 🌟 ETtoday (45)  │
├──────────────────┼──────────────────┼──────────────────┤
│ • 新聞標題 1     │ • 新聞標題 1     │ • 新聞標題 1     │
│ • 新聞標題 2     │ • 新聞標題 2     │ • 新聞標題 2     │
│   ...            │   ...            │   ...            │
└──────────────────┴──────────────────┴──────────────────┘

┌────────────────────────────────────────────────┐
│ 🎯 ETtoday 缺少的新聞 (15)                      │
├────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────┐ │
│ │ 台北市長宣布新政策 影響百萬市民              │ │
│ │ 來源: UDN                                   │ │
│ │ [✍️ 用 Claude 改寫] [🔗 查看原文]           │ │
│ └────────────────────────────────────────────┘ │
└────────────────────────────────────────────────┘
```

### 改寫結果 Modal

```
┌────────────────────────────────────────────────┐
│ ✍️ AI 改寫結果                                  │
├────────────────────────────────────────────────┤
│ 原始新聞: 台北市長宣布新政策                    │
│ 來源: UDN                                       │
│                                                 │
│ 📌 改寫標題                                     │
│ ┌────────────────────────────────────────────┐ │
│ │ 北市新政策上路 百萬市民受惠                 │ │
│ └────────────────────────────────────────────┘ │
│                                                 │
│ 📝 導言 (250字內)                               │
│ ┌────────────────────────────────────────────┐ │
│ │ 台北市政府今(8)日宣布...                    │ │
│ └────────────────────────────────────────────┘ │
│                                                 │
│ 📄 完整內文                                     │
│ ┌────────────────────────────────────────────┐ │
│ │ 完整報導內容...                              │ │
│ └────────────────────────────────────────────┘ │
│                                                 │
│ [關閉]                                          │
└────────────────────────────────────────────────┘
```

## ⚙️ 技術架構

### 後端 (Flask)

- **news_dashboard.py** - 主程式
- **API 端點**:
  - `POST /api/crawl` - 爬取所有來源並比對
  - `POST /api/rewrite` - Claude API 改寫單則新聞

### 前端 (HTML + JavaScript)

- **templates/dashboard.html** - 響應式儀表板介面
- **特色**:
  - 漸變色設計
  - 即時爬取進度顯示
  - Modal 彈窗顯示改寫結果
  - 完全響應式布局

### AI 改寫

- **Claude API**: Sonnet 4 模型
- **寫作技能**: 唐鎮宇新聞報導風格
- **核心原則**:
  - 倒金字塔結構
  - 金字塔原理 (麥肯錫寫作法)
  - 數據先行
  - 導言涵蓋 5W1H

## 🔧 設定檔說明

### config.yaml

系統使用 `config.yaml` 設定爬蟲來源:

```yaml
sources:
  - source_id: udn
    source_name: UDN
    domain_contains: udn.com
    sections:
      - section_id: homepage
        url: https://udn.com/news/index
        weight: 5
        selectors:
          - ".story-list a"
          - "main a[href*='/news/story/']"
```

### Claude API Key

API Key 已硬編碼在 `news_dashboard.py`:

```python
CLAUDE_API_KEY = "sk-ant-api03-..."
```

如需更換,請編輯此行。

## 📊 爬蟲邏輯

### 比對原理

1. **正規化標題**:
   ```python
   normalize_title("台北市長宣布新政策")
   # → "台北市長宣布新政策"
   ```

2. **建立集合比對**:
   ```python
   ettoday_titles = {normalize_title(t) for t in ettoday}
   missing = [n for n in udn+tvbs if n not in ettoday_titles]
   ```

3. **去重**:
   相同標題只保留一則

### ETtoday 選擇器

當前使用的選擇器:
```python
selectors = [
    "h3 a",
    ".part_list_2 h3 a",
    ".piece h3 a",
]
```

**注意**: ETtoday 網站可能改版,屆時需要更新選擇器。

## 🐛 常見問題

### Q: 爬取失敗怎麼辦?

**A**: 可能原因:
1. 網路連線問題
2. 網站改版,選擇器失效
3. 被網站封鎖 (過於頻繁請求)

**解決方式**:
- 檢查網路連線
- 執行 `python3 tests/test_crawler_health.py` 檢查選擇器健康度
- 更新 `config.yaml` 中的選擇器

### Q: Claude 改寫失敗?

**A**: 可能原因:
1. API Key 無效或過期
2. API 配額用盡
3. 網路連線問題

**解決方式**:
- 檢查 API Key 是否正確
- 查看 Anthropic 帳戶額度
- 檢查網路連線

### Q: 找不到缺少的新聞?

**A**: 可能原因:
1. ETtoday 報導很完整,沒有遺漏
2. 爬取時間點不同,UDN/TVBS 較早報導
3. 標題相似度判定過於嚴格

**解決方式**:
- 等待一段時間後重新爬取
- 調整 `normalize_title` 函數的邏輯

### Q: 改寫品質不好?

**A**: 可能原因:
1. 原始新聞內容不足
2. Prompt 需要優化
3. 模型溫度設定問題

**解決方式**:
- 修改 `news_dashboard.py` 中的 `system_prompt`
- 調整 `temperature` 參數 (當前 0.7)
- 增加範例 few-shot learning

## 📈 效能優化

### 當前效能

- **爬取時間**: 15-30 秒 (3 個來源)
- **改寫時間**: 5-10 秒/篇
- **記憶體使用**: < 200MB

### 優化建議

1. **非同步爬蟲**: 改用 `asyncio` + `aiohttp`
2. **快取機制**: Redis 快取爬取結果
3. **批次改寫**: 一次改寫多則新聞
4. **資料庫儲存**: PostgreSQL 儲存歷史記錄

## 🔐 安全注意事項

1. **API Key 保護**:
   - 不要將 API Key 提交到 Git
   - 使用環境變數儲存

2. **Rate Limiting**:
   - 避免過於頻繁請求媒體網站
   - 遵守 robots.txt

3. **版權問題**:
   - 改寫內容僅供參考
   - 發布前需人工審核
   - 註明原始來源

## 📞 技術支援

如有問題:
1. 檢查 `DASHBOARD_GUIDE.md` (本文件)
2. 查看 `DESIGN_REVIEW.md` 了解系統設計
3. 執行 `./verify.sh` 驗證環境
4. 查看 Flask 終端機輸出的錯誤訊息

## 🎉 使用範例

### 完整工作流程

```bash
# 1. 啟動系統
cd /Users/nightpluie/Desktop/newsfollow
./start_dashboard.sh

# 2. 開啟瀏覽器
# http://localhost:5000

# 3. 點擊「開始爬取並分析」

# 4. 等待結果顯示

# 5. 在「ETtoday 缺少的新聞」區塊
#    點擊「用 Claude 改寫」

# 6. 複製改寫結果

# 7. 貼到 ETtoday 後台發布
```

## 📝 更新日誌

### v1.0.0 (2026-02-08)

- ✅ 初始版本發布
- ✅ 支援 UDN、TVBS、ETtoday 爬取
- ✅ Claude API 整合
- ✅ 唐鎮宇寫作風格改寫
- ✅ 響應式儀表板介面

---

**祝使用愉快! 🎉**
