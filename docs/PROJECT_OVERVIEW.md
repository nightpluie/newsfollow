# 新聞監控系統 - 專案說明

## 📋 專案目的

這是一個**自動化新聞監控工具**，幫助 ETtoday 記者快速找出「其他媒體有報、但 ETtoday 還沒報」的新聞，避免漏掉重要新聞。

---

## 🎯 核心功能

### 1️⃣ **自動爬取競爭對手新聞**
- 監控 4 家主流媒體：UDN、TVBS、中時、三立
- 每家抓取 25 則新聞（分為首頁、跑馬燈、熱門新聞等區塊）
- 同時也爬 ETtoday 新聞（用來比對）

### 2️⃣ **智能比對去重**
- 用「混合策略」判斷兩則新聞是否為同一事件：
  - **演算法快速過濾**：計算標題相似度（87.5% 準確）
  - **AI 精準判斷**：模糊案例交給 GPT-4.1-nano 確認（準確率提升到 95%+）
- 找出「其他媒體有、但 ETtoday 沒有」的新聞

### 3️⃣ **重要性評分**
- 根據多個因素給新聞打分（1-5 顆星）：
  - 有幾家媒體報導（越多家越重要）
  - 新聞位置（跑馬燈 > 熱門 > 首頁）
  - 關鍵字（地震、颱風、總統等加分）
- 自動過濾不重要的新聞（過濾率 57%）

### 4️⃣ **AI 自動改寫**
- 使用 Claude Haiku 4.5 + 新聞記者寫作風格
- 綜合多家媒體的報導內容，重新撰寫為 ETtoday 風格
- 輸出標題 + 完整內文（約 800 字）

---

## 🌐 監控範圍

### **鎖定網站（4 家競爭對手 + 1 家自己）**

| 媒體 | 監控區域 | 每次抓取 | 權重 |
|------|----------|----------|------|
| **UDN 聯合新聞網** | 首頁、即時、焦點 | 75 則 | 高 |
| **TVBS** | 首頁、跑馬燈、熱門 | 75 則 | 高 |
| **中時新聞網** | 即時、首頁 | 50 則 | 中 |
| **三立新聞網** | 全部、首頁 | 50 則 | 中 |
| **ETtoday（基準）** | 焦點、熱門 | ~140 則 | - |

**總計**：每次分析約 **390 則新聞**

---

## ⚙️ 技術架構

### **爬蟲技術**
```
BeautifulSoup + requests（當前）
↓
平行爬取（ThreadPoolExecutor，5 個同時）
↓
5 分鐘快取（避免重複爬取）
```

### **比對策略**
```
標題相似度計算（混合演算法）
├─ 高相似度（≥60%）→ 直接判定為相同 ✅
├─ 低相似度（<30%）→ 直接判定為不同 ❌
└─ 中間地帶（30-60%）→ 交給 GPT-4.1-nano 判斷 🤖
```

### **評分機制**
```
總分 = 來源數量(40%) + 權重分數(30%) + 區域類型(20%) + 關鍵字(10%)
↓
轉換為星級：⭐ ~ ⭐⭐⭐⭐⭐
↓
過濾規則：至少 2 家來源 OR 單一來源但 ≥60 分
```

### **AI 改寫**
```
選擇來源（可多選）
↓
抓取完整內容（最多 20 段）
↓
Claude Haiku 4.5 + 寫作技能
↓
輸出：標題 + 內文（純文字）
```

---

## 📊 實際表現

### **速度**
- ⏱️ **首次分析**：12-15 秒（含爬取 + 比對）
- ⏱️ **快取命中**：2-3 秒（只需比對）
- ⏱️ **AI 改寫**：5-10 秒/篇

### **準確率**
- 🎯 **演算法比對**：87.5%
- 🎯 **混合策略**：95%+
- 🎯 **誤判率降低**：60%

### **成本（每月）**
- 💰 **爬蟲**：$0（免費）
- 💰 **GPT-4.1-nano**：~$1-2（相似度比對，約 200 次/分析）
- 💰 **Claude Haiku 4.5**：~$3-5（改寫，看使用量）
- 💰 **總計**：**$5-10/月**

---

## ⚠️ 已知問題

### **1. Render 部署問題（雲端版）**

**現象**：
- 本機版正常運作 ✅
- Render 線上版在「階段 3」卡住或超時 ❌
- 錯誤訊息：`The string did not match the expected pattern`

**可能原因**：
- **記憶體不足**：Render 免費方案只有 512MB，可能不夠用
- **網路延遲**：Render 伺服器到 OpenAI API 較慢
- **Worker 超時**：雖然已增加到 300 秒，但可能還是不夠

**解決方案（進行中）**：
- ✅ 已加上 API timeout 保護（10 秒）
- ✅ 已增加 worker timeout（300 秒）
- ✅ 已改進錯誤日誌
- 🔄 考慮升級 Render 方案或換平台（Railway、Fly.io）

### **2. 爬蟲穩定性**

**可能問題**：
- 網站改版 → CSS 選擇器失效
- 反爬蟲機制 → IP 被封鎖
- SSL 警告 → ETtoday 網站 HTTPS 憑證問題

**解決方案**：
- 定期檢查爬蟲是否正常
- 未來考慮加上錯誤通知

### **3. 相似度比對邊緣案例**

**問題**：
- 不同角度的同一事件可能被誤判為不同新聞
- 例如：「寇世勳道歉」vs「寇世勳喊話劇組停止製作」

**解決方案**：
- 已使用混合策略（演算法 + LLM）
- 可調整閾值（0.3-0.6 → 0.25-0.55）

---

## 🚀 未來擴展方向

### **短期優化（0-3 個月）**
- [ ] 修復 Render 部署問題
- [ ] 加上 PostgreSQL（替代 SQLite）
- [ ] 加上 Redis 快取（替代檔案快取）
- [ ] 改善錯誤處理和日誌

### **中期擴展（3-12 個月）**
- [ ] 增加監控網站（10-15 家）
- [ ] 遷移到 Scrapy（更強大的爬蟲框架）
- [ ] 加上排程任務（定時自動分析）
- [ ] 加上通知系統（重大新聞推播）

### **長期規劃（1 年+）**
- [ ] 監控 30+ 家網站
- [ ] 使用 OpenClaw 或付費爬蟲服務
- [ ] 趨勢分析和熱門話題追蹤
- [ ] 多語言支援（國際新聞）

---

## 📂 專案結構

```
newsfollow/
├── news_dashboard.py          # 主程式（Flask + 爬蟲 + API）
├── hybrid_similarity.py       # 混合相似度比對
├── cache_manager.py           # 快取管理（5 分鐘 TTL）
├── config.yaml                # 新聞來源配置
├── render.yaml                # Render 部署配置
├── templates/
│   └── dashboard.html         # Web 前端介面
├── .env                       # 環境變數（API Keys）
└── cache/                     # 快取資料目錄
```

---

## 🔑 關鍵技術決策

### **為什麼用 BeautifulSoup 而不是 Scrapy？**
- 現階段只有 4 家網站，BeautifulSoup 足夠簡單
- 未來擴展到 10+ 家網站時再考慮 Scrapy

### **為什麼用混合策略而不是純 AI？**
- 成本考量：純 AI 每次分析需要 14,000+ 次調用（太貴）
- 效率考量：演算法快速過濾 70%，只有 30% 需要 AI
- 實際調用：約 200 次/分析（可接受）

### **為什麼用 GPT-4.1-nano 而不是 GPT-4o-mini？**
- 更快：3-5 倍速度提升
- 更便宜：成本降低 50%+
- 夠用：在相似度判斷任務上表現良好

### **為什麼用 Claude Haiku 而不是 Sonnet？**
- 改寫任務不需要最強推理能力
- Haiku 配合 Skills API 效果已足夠
- 成本降低 90%（重要！）

---

## 💡 使用建議

### **本機版（開發/測試）**
```bash
cd /Users/nightpluie/Desktop/newsfollow
source .venv/bin/activate
python news_dashboard.py
# 訪問 http://localhost:8080
```

### **線上版（生產環境）**
- 目前 Render 部署有問題（記憶體/超時）
- 建議：升級 Render 方案或換平台

### **最佳實踐**
- ✅ 定期檢查爬蟲是否正常（網站改版）
- ✅ 監控 API 成本（避免超支）
- ✅ 定期清理快取（避免資料過舊）
- ✅ 備份重要資料（新聞資料庫）

---

**專案版本**：v1.1 (Prototype)
**最後更新**：2026-02-09
**維護者**：Claude Code + Happy
